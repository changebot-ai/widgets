<!doctype html>
<html dir="ltr" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vanilla JS Demo - Changebot Widgets</title>

  <script type="module" src="/build/widgets.esm.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
    }

    .demo-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .demo-header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .demo-header .badge-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .demo-header .badge-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .control-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .control-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .control-row:last-child {
      margin-bottom: 0;
    }

    .control-row label {
      min-width: 120px;
      font-size: 13px;
      color: #555;
    }

    .control-row select,
    .control-row input[type="text"],
    .control-row input[type="datetime-local"] {
      flex: 1;
      min-width: 0;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      background: white;
    }

    .control-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .control-row .btn {
      flex-shrink: 0;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-secondary {
      background: #e9ecef;
      color: #495057;
    }

    .btn-secondary:hover {
      background: #dee2e6;
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-success:hover {
      background: #38a169;
    }

    .btn-warning {
      background: #ed8936;
      color: white;
    }

    .btn-warning:hover {
      background: #dd6b20;
    }

    .btn-danger {
      background: #e53e3e;
      color: white;
    }

    .btn-danger:hover {
      background: #c53030;
    }

    .debug-panel {
      background: #1e1e2e;
      color: #cdd6f4;
      border-radius: 12px;
      padding: 20px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      margin-top: 24px;
    }

    .debug-panel h3 {
      color: #89b4fa;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .debug-row {
      display: flex;
      margin-bottom: 8px;
    }

    .debug-label {
      color: #a6adc8;
      min-width: 180px;
    }

    .debug-value {
      color: #a6e3a1;
    }

    .debug-value.warning {
      color: #f9e2af;
    }

    .mock-data-info {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #313244;
    }

    .mock-data-info h4 {
      color: #89b4fa;
      margin-bottom: 12px;
      font-size: 13px;
    }

    .mock-item {
      display: flex;
      gap: 12px;
      margin-bottom: 6px;
      font-size: 11px;
    }

    .mock-item .id {
      color: #6c7086;
      min-width: 30px;
    }

    .mock-item .title {
      color: #cdd6f4;
      flex: 1;
    }

    .mock-item .date {
      color: #94e2d5;
    }

    .mock-item .target {
      color: #f5c2e7;
      min-width: 60px;
    }

    .css-vars-section {
      margin-top: 24px;
    }

    .css-vars-section summary {
      cursor: pointer;
      font-weight: 600;
      color: #333;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      list-style: none;
    }

    .css-vars-section summary::-webkit-details-marker {
      display: none;
    }

    .css-vars-section summary::before {
      content: '+ ';
    }

    .css-vars-section[open] summary::before {
      content: '- ';
    }

    .css-vars-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      padding: 16px 0;
    }

    .css-var-input {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .css-var-input label {
      font-size: 11px;
      color: #666;
      font-family: monospace;
    }

    .css-var-input input {
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
      font-family: monospace;
    }

    .component-preview {
      background: white;
      border-radius: 12px;
      padding: 32px;
      margin-top: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .preview-label {
      color: #888;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .inline-badge {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 24px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    /* Badge always visible in header */
    #badge-container {
      display: inline-block;
    }
  </style>
</head>

<body>
  <!-- Provider with dynamic mock data -->
  <changebot-provider id="provider" scope="vanilla-demo"></changebot-provider>

  <!-- Banner (conditionally shown) -->
  <div id="banner-container">
    <changebot-banner id="banner" scope="vanilla-demo" position="top"></changebot-banner>
  </div>

  <header class="demo-header">
    <h1>Vanilla JS Demo</h1>
    <div class="badge-wrapper">
      <span class="badge-label">Updates:</span>
      <div id="badge-container">
        <changebot-badge id="badge" scope="vanilla-demo" indicator="count"></changebot-badge>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="controls-grid">
      <!-- Last Viewed Time Controls -->
      <div class="control-section">
        <h3>Last Viewed Time</h3>
        <div class="button-row">
          <button class="btn btn-secondary" onclick="setLastViewed('now')">Now</button>
          <button class="btn btn-secondary" onclick="setLastViewed('1day')">1 Day Ago</button>
          <button class="btn btn-secondary" onclick="setLastViewed('7days')">7 Days</button>
          <button class="btn btn-secondary" onclick="setLastViewed('30days')">30 Days</button>
          <button class="btn btn-danger" onclick="setLastViewed('clear')">Clear</button>
        </div>
        <div class="control-row" style="margin-top: 12px;">
          <label>Custom:</label>
          <input type="datetime-local" id="customDate" />
          <button class="btn btn-primary" onclick="setCustomDate()">Set</button>
        </div>
      </div>

      <!-- Theme Controls -->
      <div class="control-section">
        <h3>Theme</h3>
        <div class="control-row">
          <label>Mode:</label>
          <select id="themeMode" onchange="updateTheme()">
            <option value="fixed">Fixed Theme</option>
            <option value="auto">Light/Dark Auto</option>
          </select>
        </div>
        <div class="control-row" id="fixedThemeRow">
          <label>Theme:</label>
          <select id="fixedTheme" onchange="updateTheme()">
            <optgroup label="Light Themes">
              <option value="catppuccin-latte">Catppuccin Latte</option>
              <option value="gruvbox-light">Gruvbox Light</option>
              <option value="solarized-light">Solarized Light</option>
              <option value="everforest-light">Everforest Light</option>
              <option value="frost">Frost</option>
            </optgroup>
            <optgroup label="Dark Themes">
              <option value="catppuccin-frappe">Catppuccin Frappe</option>
              <option value="catppuccin-macchiato">Catppuccin Macchiato</option>
              <option value="catppuccin-mocha" selected>Catppuccin Mocha</option>
              <option value="gruvbox-dark">Gruvbox Dark</option>
              <option value="dracula">Dracula</option>
              <option value="nord">Nord</option>
              <option value="solarized-dark">Solarized Dark</option>
              <option value="everforest-dark">Everforest Dark</option>
              <option value="tokyo-night">Tokyo Night</option>
              <option value="cyberpunk">Cyberpunk</option>
            </optgroup>
          </select>
        </div>
        <div class="control-row" id="lightThemeRow" style="display: none;">
          <label>Light Theme:</label>
          <select id="lightTheme" onchange="updateTheme()">
            <option value="catppuccin-latte" selected>Catppuccin Latte</option>
            <option value="gruvbox-light">Gruvbox Light</option>
            <option value="solarized-light">Solarized Light</option>
            <option value="everforest-light">Everforest Light</option>
            <option value="frost">Frost</option>
          </select>
        </div>
        <div class="control-row" id="darkThemeRow" style="display: none;">
          <label>Dark Theme:</label>
          <select id="darkTheme" onchange="updateTheme()">
            <option value="catppuccin-frappe">Catppuccin Frappe</option>
            <option value="catppuccin-macchiato">Catppuccin Macchiato</option>
            <option value="catppuccin-mocha" selected>Catppuccin Mocha</option>
            <option value="gruvbox-dark">Gruvbox Dark</option>
            <option value="dracula">Dracula</option>
            <option value="nord">Nord</option>
            <option value="solarized-dark">Solarized Dark</option>
            <option value="everforest-dark">Everforest Dark</option>
            <option value="tokyo-night">Tokyo Night</option>
            <option value="cyberpunk">Cyberpunk</option>
          </select>
        </div>
      </div>

      <!-- Component Visibility -->
      <div class="control-section">
        <h3>Components</h3>
        <div class="control-row">
          <input type="checkbox" id="showBadge" checked onchange="toggleComponent('badge')" />
          <label>Badge</label>
          <select id="badgeIndicator" onchange="updateBadge()" style="margin-left: auto; flex: none; width: 100px;">
            <option value="count" selected>Count</option>
            <option value="dot">Dot</option>
          </select>
        </div>
        <div class="control-row">
          <input type="checkbox" id="showPanel" checked onchange="toggleComponent('panel')" />
          <label>Panel</label>
          <select id="panelMode" onchange="updatePanel()" style="margin-left: auto; flex: none; width: 140px;">
            <option value="drawer-right" selected>Drawer Right</option>
            <option value="drawer-left">Drawer Left</option>
            <option value="modal">Modal</option>
          </select>
        </div>
        <div class="control-row">
          <input type="checkbox" id="showBanner" checked onchange="toggleComponent('banner')" />
          <label>Banner</label>
          <select id="bannerPosition" onchange="updateBanner()" style="margin-left: auto; flex: none; width: 140px;">
            <option value="top" selected>Top</option>
            <option value="bottom">Bottom</option>
          </select>
        </div>
        <div class="control-row">
          <input type="checkbox" id="showToast" checked onchange="toggleComponent('toast')" />
          <label>Toast</label>
          <select id="toastPosition" onchange="updateToast()" style="margin-left: auto; flex: none; width: 140px;">
            <option value="bottom-right" selected>Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
          </select>
        </div>
      </div>

      <!-- Actions -->
      <div class="control-section">
        <h3>Actions</h3>
        <div class="button-row">
          <button class="btn btn-primary" onclick="openPanel()">Open Panel</button>
          <button class="btn btn-success" onclick="showToast()">Show Toast</button>
          <button class="btn btn-warning" onclick="showBanner()">Show Banner</button>
        </div>
        <div class="button-row" style="margin-top: 12px;">
          <button class="btn btn-secondary" onclick="refreshDebug()">Refresh Debug</button>
          <button class="btn btn-danger" onclick="resetAll()">Reset All</button>
        </div>
      </div>

      <!-- Preview Mode -->
      <div class="control-section">
        <h3>Preview Mode (CSS Development)</h3>
        <p style="font-size: 12px; color: #666; margin-bottom: 12px;">
          Show toast/banner with mock content - no provider needed. Useful for styling.
        </p>
        <div class="button-row">
          <button class="btn btn-success" id="previewToastBtn" onclick="togglePreviewToast()">Show Preview Toast</button>
          <button class="btn btn-warning" id="previewBannerBtn" onclick="togglePreviewBanner()">Show Preview Banner</button>
        </div>
      </div>
    </div>

    <!-- Custom CSS Variables -->
    <details class="control-section css-vars-section">
      <summary>Custom CSS Variables</summary>
      <div class="css-vars-grid">
        <div class="css-var-input">
          <label>--cb-badge-bg</label>
          <input type="text" id="css-badge-bg" placeholder="#667eea" oninput="applyCssVar('badge', 'bg', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-badge-text</label>
          <input type="text" id="css-badge-text" placeholder="#ffffff" oninput="applyCssVar('badge', 'text', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-panel-bg</label>
          <input type="text" id="css-panel-bg" placeholder="#1e1e2e" oninput="applyCssVar('panel', 'bg', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-panel-text</label>
          <input type="text" id="css-panel-text" placeholder="#cdd6f4" oninput="applyCssVar('panel', 'text', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-banner-bg</label>
          <input type="text" id="css-banner-bg" placeholder="#1e1e2e" oninput="applyCssVar('banner', 'bg', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-banner-text</label>
          <input type="text" id="css-banner-text" placeholder="#cdd6f4" oninput="applyCssVar('banner', 'text', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-toast-bg</label>
          <input type="text" id="css-toast-bg" placeholder="#1e1e2e" oninput="applyCssVar('toast', 'bg', this.value)" />
        </div>
        <div class="css-var-input">
          <label>--cb-toast-text</label>
          <input type="text" id="css-toast-text" placeholder="#cdd6f4" oninput="applyCssVar('toast', 'text', this.value)" />
        </div>
      </div>
      <button class="btn btn-secondary" onclick="clearCssVars()">Clear Custom Styles</button>
    </details>

    <!-- Debug Panel -->
    <div class="debug-panel">
      <h3>Debug Info</h3>
      <div class="debug-row">
        <span class="debug-label">Last Viewed (raw):</span>
        <span class="debug-value" id="debug-lastviewed-raw">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">Last Viewed (formatted):</span>
        <span class="debug-value" id="debug-lastviewed">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">Calculated Unread Count:</span>
        <span class="debug-value" id="debug-count">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">Current Theme:</span>
        <span class="debug-value" id="debug-theme">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">localStorage Key:</span>
        <span class="debug-value">changebot:lastViewed:vanilla-demo</span>
      </div>

      <div class="mock-data-info">
        <h4>Mock Data Publications</h4>
        <div id="mock-data-list"></div>
      </div>
    </div>
  </div>

  <!-- Panel Component -->
  <div id="panel-container">
    <changebot-panel id="panel" scope="vanilla-demo" mode="drawer-right"></changebot-panel>
  </div>

  <!-- Toast Component -->
  <div id="toast-container">
    <changebot-toast id="toast" scope="vanilla-demo" position="bottom-right"></changebot-toast>
  </div>

  <script>
    // Generate mock data with dynamic dates
    function generateMockData() {
      const now = Date.now();
      const day = 24 * 60 * 60 * 1000;

      return {
        widget: {
          title: 'Product Updates',
          subheading: 'Latest features and improvements',
          slug: 'vanilla-demo',
          branded: false
        },
        publications: [
          {
            id: 1,
            title: "Today's Feature Release",
            content: `<p>We just launched a brand new feature that will revolutionize your workflow! This update brings significant improvements to how you manage your projects and collaborate with your team.</p>
              <img src="https://picsum.photos/800/400?random=1" alt="Feature screenshot" />
              <p>Key highlights include:</p>
              <ul>
                <li>Real-time collaboration with team members</li>
                <li>Advanced filtering and search capabilities</li>
                <li>Customizable dashboards for every user</li>
                <li>Integration with popular third-party tools</li>
              </ul>
              <p>We've been working on this for months and we're thrilled to finally share it with you. Try it out today and let us know what you think!</p>`,
            display_date: new Date().toISOString().split('T')[0],
            published_at: new Date(now - 6 * 60 * 60 * 1000).toISOString(),
            expires_on: null,
            highlight_target: 'banner',
            hosted_url: 'https://example.com/feature-release',
            tags: [{ id: 1, name: 'Feature', color: '#10b981' }]
          },
          {
            id: 2,
            title: 'Performance Improvements (3 days ago)',
            content: `<p>We've made significant performance improvements across the entire platform. Loading times have been reduced by 40% through careful optimization of our backend services and frontend rendering pipeline.</p>
              <figure><img src="https://picsum.photos/800/400?random=2" alt="Performance graph" /></figure>
              <p>Here's what we improved:</p>
              <ul>
                <li>Database query optimization reducing response times by 50%</li>
                <li>Implemented lazy loading for images and components</li>
                <li>Added CDN caching for static assets worldwide</li>
                <li>Reduced JavaScript bundle size by 30%</li>
              </ul>
              <p>These improvements mean faster page loads, smoother interactions, and a better overall experience for all users. We're committed to continuous performance optimization.</p>`,
            display_date: new Date(now - 3 * day).toISOString().split('T')[0],
            published_at: new Date(now - 3 * day).toISOString(),
            expires_on: null,
            highlight_target: 'toast',
            hosted_url: 'https://example.com/performance',
            tags: [{ id: 2, name: 'Performance', color: '#3b82f6' }]
          },
          {
            id: 3,
            title: 'Bug Fixes (1 week ago)',
            content: '<p>Fixed several reported issues including form validation bugs.</p>',
            display_date: new Date(now - 7 * day).toISOString().split('T')[0],
            published_at: new Date(now - 7 * day).toISOString(),
            expires_on: null,
            highlight_target: null,
            hosted_url: null,
            tags: [{ id: 3, name: 'Bug Fix', color: '#ef4444' }]
          },
          {
            id: 4,
            title: 'New Dashboard (2 weeks ago)',
            content: '<p>Introducing our redesigned analytics dashboard.</p>',
            display_date: new Date(now - 14 * day).toISOString().split('T')[0],
            published_at: new Date(now - 14 * day).toISOString(),
            expires_on: null,
            highlight_target: null,
            hosted_url: null,
            tags: [{ id: 1, name: 'Feature', color: '#10b981' }]
          },
          {
            id: 5,
            title: 'API Updates (1 month ago)',
            content: '<p>New API endpoints for improved integration.</p>',
            display_date: new Date(now - 30 * day).toISOString().split('T')[0],
            published_at: new Date(now - 30 * day).toISOString(),
            expires_on: null,
            highlight_target: null,
            hosted_url: null,
            tags: [{ id: 4, name: 'API', color: '#8b5cf6' }]
          }
        ]
      };
    }

    // Initialize mock data
    const mockData = generateMockData();

    // Set mock data on provider
    function initProvider() {
      const provider = document.getElementById('provider');
      if (provider) {
        provider.setAttribute('mock-data', JSON.stringify(mockData));
      }
    }

    // Last Viewed Controls
    function setLastViewed(period) {
      const now = Date.now();
      const day = 24 * 60 * 60 * 1000;
      let timestamp;

      switch (period) {
        case 'now':
          timestamp = now;
          break;
        case '1day':
          timestamp = now - day;
          break;
        case '7days':
          timestamp = now - 7 * day;
          break;
        case '30days':
          timestamp = now - 30 * day;
          break;
        case 'clear':
          localStorage.removeItem('changebot:lastViewed:vanilla-demo');
          location.reload();
          return;
      }

      localStorage.setItem('changebot:lastViewed:vanilla-demo', timestamp.toString());
      location.reload();
    }

    function setCustomDate() {
      const input = document.getElementById('customDate');
      if (input.value) {
        const timestamp = new Date(input.value).getTime();
        localStorage.setItem('changebot:lastViewed:vanilla-demo', timestamp.toString());
        location.reload();
      }
    }

    // Theme Controls
    function updateTheme() {
      const mode = document.getElementById('themeMode').value;
      const fixedRow = document.getElementById('fixedThemeRow');
      const lightRow = document.getElementById('lightThemeRow');
      const darkRow = document.getElementById('darkThemeRow');

      if (mode === 'fixed') {
        fixedRow.style.display = 'flex';
        lightRow.style.display = 'none';
        darkRow.style.display = 'none';

        const theme = document.getElementById('fixedTheme').value;
        applyThemeToComponents(theme, null, null);
      } else {
        fixedRow.style.display = 'none';
        lightRow.style.display = 'flex';
        darkRow.style.display = 'flex';

        const light = document.getElementById('lightTheme').value;
        const dark = document.getElementById('darkTheme').value;
        applyThemeToComponents(null, light, dark);
      }

      refreshDebug();
    }

    function applyThemeToComponents(fixed, light, dark) {
      const components = ['badge', 'panel', 'banner', 'toast'];

      components.forEach(comp => {
        const el = document.getElementById(comp);
        if (el) {
          if (fixed) {
            el.setAttribute('theme', fixed);
            el.removeAttribute('light');
            el.removeAttribute('dark');
          } else {
            el.removeAttribute('theme');
            el.setAttribute('light', light);
            el.setAttribute('dark', dark);
          }
        }
      });
    }

    // Component Visibility
    function toggleComponent(comp) {
      const checkbox = document.getElementById('show' + comp.charAt(0).toUpperCase() + comp.slice(1));
      const container = document.getElementById(comp + '-container');

      if (container) {
        container.style.display = checkbox.checked ? (comp === 'badge' ? 'inline-block' : 'block') : 'none';
      }
    }

    function updateBadge() {
      const badge = document.getElementById('badge');
      const indicator = document.getElementById('badgeIndicator').value;
      if (badge) {
        badge.setAttribute('indicator', indicator);
      }
    }

    function updatePanel() {
      const panel = document.getElementById('panel');
      const mode = document.getElementById('panelMode').value;
      if (panel) {
        panel.setAttribute('mode', mode);
      }
    }

    function updateBanner() {
      const banner = document.getElementById('banner');
      const position = document.getElementById('bannerPosition').value;
      if (banner) {
        banner.setAttribute('position', position);
      }
    }

    function updateToast() {
      const toast = document.getElementById('toast');
      const position = document.getElementById('toastPosition').value;
      if (toast) {
        toast.setAttribute('position', position);
      }
    }

    // Actions
    function openPanel() {
      document.dispatchEvent(new CustomEvent('changebot:action', {
        detail: { type: 'openDisplay', scope: 'vanilla-demo' },
        bubbles: true,
        composed: true
      }));
    }

    async function showToast() {
      const toast = document.getElementById('toast');
      if (toast && toast.show) {
        await toast.show(mockData.publications[1]); // 3 days ago item
      }
    }

    async function showBanner() {
      const banner = document.getElementById('banner');
      if (banner && banner.show) {
        await banner.show(mockData.publications[0]); // Today's item
      }
    }

    function resetAll() {
      localStorage.removeItem('changebot:lastViewed:vanilla-demo');
      location.reload();
    }

    // Preview Mode
    let previewToast = null;
    let previewBanner = null;

    function togglePreviewToast() {
      const btn = document.getElementById('previewToastBtn');
      if (previewToast) {
        previewToast.remove();
        previewToast = null;
        btn.textContent = 'Show Preview Toast';
        btn.classList.remove('btn-danger');
        btn.classList.add('btn-success');
      } else {
        previewToast = document.createElement('changebot-toast');
        previewToast.setAttribute('preview', 'true');
        previewToast.setAttribute('position', document.getElementById('toastPosition').value);
        // Apply current theme
        const mode = document.getElementById('themeMode').value;
        if (mode === 'fixed') {
          previewToast.setAttribute('theme', document.getElementById('fixedTheme').value);
        } else {
          previewToast.setAttribute('light', document.getElementById('lightTheme').value);
          previewToast.setAttribute('dark', document.getElementById('darkTheme').value);
        }
        document.body.appendChild(previewToast);
        btn.textContent = 'Hide Preview Toast';
        btn.classList.remove('btn-success');
        btn.classList.add('btn-danger');
      }
    }

    function togglePreviewBanner() {
      const btn = document.getElementById('previewBannerBtn');
      if (previewBanner) {
        previewBanner.remove();
        previewBanner = null;
        btn.textContent = 'Show Preview Banner';
        btn.classList.remove('btn-danger');
        btn.classList.add('btn-warning');
      } else {
        previewBanner = document.createElement('changebot-banner');
        previewBanner.setAttribute('preview', 'true');
        // Apply current theme
        const mode = document.getElementById('themeMode').value;
        if (mode === 'fixed') {
          previewBanner.setAttribute('theme', document.getElementById('fixedTheme').value);
        } else {
          previewBanner.setAttribute('light', document.getElementById('lightTheme').value);
          previewBanner.setAttribute('dark', document.getElementById('darkTheme').value);
        }
        document.body.insertBefore(previewBanner, document.body.firstChild);
        btn.textContent = 'Hide Preview Banner';
        btn.classList.remove('btn-warning');
        btn.classList.add('btn-danger');
      }
    }

    // CSS Variables
    function applyCssVar(component, prop, value) {
      const el = document.getElementById(component);
      if (el && value) {
        el.style.setProperty(`--cb-${component}-${prop}`, value);
      }
    }

    function clearCssVars() {
      const components = ['badge', 'panel', 'banner', 'toast'];
      const props = ['bg', 'text'];

      components.forEach(comp => {
        const el = document.getElementById(comp);
        if (el) {
          props.forEach(prop => {
            el.style.removeProperty(`--cb-${comp}-${prop}`);
          });
        }
        // Clear input fields
        const bgInput = document.getElementById(`css-${comp}-bg`);
        const textInput = document.getElementById(`css-${comp}-text`);
        if (bgInput) bgInput.value = '';
        if (textInput) textInput.value = '';
      });
    }

    // Debug
    function refreshDebug() {
      const raw = localStorage.getItem('changebot:lastViewed:vanilla-demo');
      const debugRaw = document.getElementById('debug-lastviewed-raw');
      const debugFormatted = document.getElementById('debug-lastviewed');
      const debugCount = document.getElementById('debug-count');
      const debugTheme = document.getElementById('debug-theme');

      debugRaw.textContent = raw || '(not set)';
      debugRaw.className = 'debug-value' + (raw ? '' : ' warning');

      if (raw) {
        const date = new Date(parseInt(raw));
        debugFormatted.textContent = date.toLocaleString();
      } else {
        debugFormatted.textContent = '(not set - first visit behavior)';
        debugFormatted.className = 'debug-value warning';
      }

      // Calculate unread count
      const lastViewed = raw ? parseInt(raw) : null;
      let count = 0;
      if (lastViewed) {
        count = mockData.publications.filter(p => {
          const pubTime = new Date(p.published_at).getTime();
          return pubTime > lastViewed;
        }).length;
      }
      debugCount.textContent = count.toString();

      // Theme info
      const mode = document.getElementById('themeMode').value;
      if (mode === 'fixed') {
        debugTheme.textContent = document.getElementById('fixedTheme').value;
      } else {
        const light = document.getElementById('lightTheme').value;
        const dark = document.getElementById('darkTheme').value;
        debugTheme.textContent = `light: ${light}, dark: ${dark}`;
      }

      // Mock data list
      const mockList = document.getElementById('mock-data-list');
      mockList.innerHTML = mockData.publications.map(p => {
        const date = new Date(p.published_at);
        return `<div class="mock-item">
          <span class="id">#${p.id}</span>
          <span class="title">${p.title}</span>
          <span class="target">${p.highlight_target || '-'}</span>
          <span class="date">${date.toLocaleDateString()}</span>
        </div>`;
      }).join('');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initProvider();
      updateTheme();

      // Refresh debug after a short delay to let components initialize
      setTimeout(refreshDebug, 100);
    });
  </script>
</body>

</html>
