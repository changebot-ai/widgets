<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Changebot Toast - Production Example</title>

    <script type="module" src="/build/widgets.esm.js"></script>
    <script nomodule src="/build/widgets.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 40px;
        background: #f5f5f5;
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      h1 {
        margin-top: 0;
        color: #333;
      }

      h2 {
        color: #555;
        margin-top: 30px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 10px;
      }

      code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
      }

      pre {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border-radius: 4px;
        overflow-x: auto;
        font-family: 'Courier New', monospace;
        margin: 20px 0;
      }

      pre code {
        background: none;
        padding: 0;
        color: inherit;
        font-size: 14px;
      }

      button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
        font-size: 14px;
      }

      button:hover {
        background: #0056b3;
      }

      button.secondary {
        background: #6c757d;
      }

      button.secondary:hover {
        background: #545b62;
      }

      .controls {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 4px;
      }

      .controls h3 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 16px;
        color: #333;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .demo-card {
        padding: 15px;
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
      }

      .demo-card h4 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 14px;
        color: #666;
      }

      .demo-card button {
        width: 100%;
        margin: 0;
      }

      .info-box {
        background: #e7f3ff;
        border: 1px solid #b3d9ff;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
      }

      .info-box p {
        margin: 5px 0;
      }

      .status {
        padding: 12px;
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
        color: #155724;
        margin: 15px 0;
        font-size: 14px;
      }

      a {
        color: #007bff;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      ul {
        line-height: 1.8;
      }

      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        padding: 8px 16px;
        background: #f0f0f0;
        border-radius: 4px;
        color: #333;
      }

      .back-link:hover {
        background: #e0e0e0;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <!-- Provider Component - Fetches updates from Changebot API -->
    <changebot-provider slug="changebot"></changebot-provider>

    <!-- Toast Components - Different positions and themes -->
    <changebot-toast id="toast-automatic" position="bottom-right"></changebot-toast>
    <changebot-toast id="toast-top-right" position="top-right" scope="toast-demos"></changebot-toast>
    <changebot-toast id="toast-top-left" position="top-left" scope="toast-demos"></changebot-toast>
    <changebot-toast id="toast-bottom-left" position="bottom-left" scope="toast-demos"></changebot-toast>

    <div class="container">
      <a href="/" class="back-link">‚Üê Back to Index</a>

      <h1>Changebot Toast - Production Example</h1>
      <p>Toast notifications automatically display the most recent unviewed update from your Changebot feed.</p>

      <div class="info-box">
        <p><strong>Live Demo:</strong> The automatic toast is connected to the real Changebot API and will appear when new updates are available.</p>
        <p><strong>Auto-Display:</strong> The toast appears automatically when new updates are published that you haven't seen yet.</p>
        <p><strong>Configuration:</strong> Use the controls below to change the theme and position of the automatic toast.</p>
      </div>

      <p>Features:</p>
      <ul>
        <li>üéØ Automatically shows the most recent unviewed update</li>
        <li>üìç Configurable positioning (top/bottom, left/right)</li>
        <li>üé® Theme support with auto light/dark mode detection</li>
        <li>‚è±Ô∏è Optional auto-dismiss timer</li>
        <li>üíæ Remembers dismissed updates using localStorage</li>
        <li>üîÑ Works seamlessly with the same provider as badge/drawer</li>
        <li>‚å®Ô∏è Keyboard accessible (Enter/Space to dismiss)</li>
      </ul>

      <h2>Manual Testing</h2>
      <p>Test different toast positions and themes with mock data:</p>

      <div class="demo-grid">
        <div class="demo-card">
          <h4>Bottom Right (Default)</h4>
          <code>position="bottom-right"</code>
          <button onclick="testToast('toast-automatic', 'bottom-right')">Show Toast</button>
        </div>

        <div class="demo-card">
          <h4>Top Right</h4>
          <code>position="top-right"</code>
          <button onclick="testToast('toast-top-right', 'top-right')">Show Toast</button>
        </div>

        <div class="demo-card">
          <h4>Top Left</h4>
          <code>position="top-left"</code>
          <button onclick="testToast('toast-top-left', 'top-left')">Show Toast</button>
        </div>

        <div class="demo-card">
          <h4>Bottom Left</h4>
          <code>position="bottom-left"</code>
          <button onclick="testToast('toast-bottom-left', 'bottom-left')">Show Toast</button>
        </div>
      </div>

      <div class="controls">
        <h3>Automatic Toast Configuration</h3>
        <div style="margin-bottom: 15px;">
          <label for="theme-select" style="display: inline-block; min-width: 100px;">Theme:</label>
          <select id="theme-select" onchange="changeTheme()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="">System Auto (Latte/Mocha)</option>
            <optgroup label="Catppuccin">
              <option value="catppuccin-latte">Latte (Light)</option>
              <option value="catppuccin-frappe">Frapp√© (Dark)</option>
              <option value="catppuccin-macchiato">Macchiato (Dark)</option>
              <option value="catppuccin-mocha">Mocha (Dark)</option>
            </optgroup>
            <optgroup label="Gruvbox">
              <option value="gruvbox-light">Gruvbox Light</option>
              <option value="gruvbox-dark">Gruvbox Dark</option>
            </optgroup>
            <optgroup label="Other Themes">
              <option value="dracula">Dracula</option>
              <option value="nord">Nord</option>
              <option value="solarized-light">Solarized Light</option>
              <option value="solarized-dark">Solarized Dark</option>
              <option value="everforest-light">Everforest Light</option>
              <option value="everforest-dark">Everforest Dark</option>
              <option value="tokyo-night">Tokyo Night</option>
              <option value="cyberpunk">Cyberpunk</option>
            </optgroup>
          </select>
        </div>
        <div style="margin-bottom: 15px;">
          <label for="position-select" style="display: inline-block; min-width: 100px;">Position:</label>
          <select id="position-select" onchange="changePosition()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
          </select>
        </div>

        <h3>Testing Controls</h3>
        <button onclick="showAllToasts()">Show All Positions</button>
        <button onclick="dismissAllToasts()">Dismiss All</button>
        <button class="secondary" onclick="resetAutoToast()">Reset Auto Toast (Clear Last Viewed)</button>
        <button class="secondary" onclick="logStore()">Log Store State</button>
      </div>

      <div id="status" class="status" style="display: none;"></div>

      <h2>Integration Code</h2>

      <h3>Basic Setup</h3>
      <pre><code>&lt;!-- Add provider once per page --&gt;
&lt;changebot-provider slug="your-slug" &gt;&lt;/changebot-provider&gt;

&lt;!-- Add toast with default position (bottom-right) --&gt;
&lt;changebot-toast&gt;&lt;/changebot-toast&gt;</code></pre>

      <h3>With Position and Theme</h3>
      <pre><code>&lt;!-- Toast at top-right with dark theme --&gt;
&lt;changebot-toast
  position="top-right"
  theme="catppuccin-mocha"&gt;
&lt;/changebot-toast&gt;

&lt;!-- Auto theme based on system preference --&gt;
&lt;changebot-toast
  position="bottom-right"
  light="catppuccin-latte"
  dark="catppuccin-mocha"&gt;
&lt;/changebot-toast&gt;</code></pre>

      <h3>With Auto-Dismiss</h3>
      <pre><code>&lt;!-- Auto-dismiss after 5 seconds --&gt;
&lt;changebot-toast
  position="bottom-right"
  auto-dismiss="5"&gt;
&lt;/changebot-toast&gt;</code></pre>

      <h3>Multiple Toasts with Different Scopes</h3>
      <pre><code>&lt;!-- General updates toast --&gt;
&lt;changebot-provider slug="general-updates" scope="general"&gt;&lt;/changebot-provider&gt;
&lt;changebot-toast
  scope="general"
  position="bottom-right"&gt;
&lt;/changebot-toast&gt;

&lt;!-- Announcement toast from different destination --&gt;
&lt;changebot-provider
  slug="announcements"
  scope="announcements"&gt;
&lt;/changebot-provider&gt;
&lt;changebot-toast
  scope="announcements"
  position="top-right"
  theme="dracula"&gt;
&lt;/changebot-toast&gt;</code></pre>

      <h2>Props Reference</h2>
      <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
        <tr style="background: #f8f9fa; font-weight: 600;">
          <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e0e0e0;">Prop</th>
          <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e0e0e0;">Type</th>
          <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e0e0e0;">Default</th>
          <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e0e0e0;">Description</th>
        </tr>
        <tr>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><code>scope</code></td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">string</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">"default"</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Connect to provider with matching scope</td>
        </tr>
        <tr>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><code>theme</code></td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Theme</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">-</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Fixed color theme</td>
        </tr>
        <tr>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><code>light</code></td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Theme</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">-</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Theme for light mode (auto-switches)</td>
        </tr>
        <tr>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><code>dark</code></td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Theme</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">-</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Theme for dark mode (auto-switches)</td>
        </tr>
        <tr>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><code>position</code></td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">"top-left" | "top-right" | "bottom-left" | "bottom-right"</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">"bottom-right"</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Screen position for the toast</td>
        </tr>
        <tr>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;"><code>auto-dismiss</code></td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">number</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">-</td>
          <td style="padding: 10px; border-bottom: 1px solid #e0e0e0;">Auto-dismiss after N seconds (optional)</td>
        </tr>
      </table>

      <p>
        <a href="/index.html">‚Üê Back to badge/drawer example</a><br>
        <a href="/test.html">View comprehensive testing page ‚Üí</a>
      </p>
    </div>

    <script>
      // Testing function to show toast with mock data
      async function testToast(id, position) {
        const toast = document.getElementById(id);
        if (toast) {
          const mockUpdate = {
            id: Date.now().toString(),
            title: `Test Toast - ${position}`,
            description: 'This is a test notification with mock data. Click the X to dismiss.',
            date: new Date().toISOString(),
            timestamp: Date.now()
          };

          await toast.show(mockUpdate);
          updateStatus(`Showing ${position} toast`);
        }
      }

      // Show all toast positions
      async function showAllToasts() {
        const toasts = [
          { id: 'toast-automatic', pos: 'bottom-right' },
          { id: 'toast-top-right', pos: 'top-right' },
          { id: 'toast-top-left', pos: 'top-left' },
          { id: 'toast-bottom-left', pos: 'bottom-left' }
        ];

        for (let i = 0; i < toasts.length; i++) {
          setTimeout(() => testToast(toasts[i].id, toasts[i].pos), i * 200);
        }

        updateStatus('Showing all toast positions');
      }

      // Dismiss all toasts
      async function dismissAllToasts() {
        const toasts = document.querySelectorAll('changebot-toast');
        for (const toast of toasts) {
          await toast.dismiss();
        }
        updateStatus('Dismissed all toasts');
      }

      // Reset automatic toast by clearing localStorage
      function resetAutoToast() {
        localStorage.removeItem('changebot:lastViewed:default');
        console.log('Cleared last viewed for automatic toast. Reloading...');
        updateStatus('Reset automatic toast. Reloading to show new updates...');
        setTimeout(() => location.reload(), 1000);
      }

      // Clear all localStorage for demos
      function clearLastViewed() {
        localStorage.removeItem('changebot:lastViewed:default');
        localStorage.removeItem('changebot:lastViewed:toast-demos');
        console.log('Cleared last viewed timestamps. Reloading...');
        updateStatus('Cleared last viewed. Reloading...');
        setTimeout(() => location.reload(), 1000);
      }

      // Change theme of all toasts
      function changeTheme() {
        const select = document.getElementById('theme-select');
        if (!select) return;

        const theme = select.value;

        // Save to localStorage
        localStorage.setItem('changebot:toast:theme', theme);

        // Apply theme to all toasts
        const toasts = document.querySelectorAll('changebot-toast');
        toasts.forEach(toast => {
          if (theme === '') {
            // System auto mode - use light and dark props
            toast.removeAttribute('theme');
            toast.setAttribute('light', 'catppuccin-latte');
            toast.setAttribute('dark', 'catppuccin-mocha');
          } else {
            // Explicit theme - remove light/dark and set theme
            toast.removeAttribute('light');
            toast.removeAttribute('dark');
            toast.setAttribute('theme', theme);
          }
        });

        if (theme === '') {
          console.log('üé® Changed all toasts to system auto theme (Latte/Mocha)');
          updateStatus('Changed to system auto theme');
        } else {
          console.log('üé® Changed all toasts to explicit theme:', theme);
          updateStatus(`Changed to ${theme} theme`);
        }
      }

      // Change position of automatic toast
      function changePosition() {
        const select = document.getElementById('position-select');
        const toast = document.getElementById('toast-automatic');

        if (!toast || !select) return;

        const position = select.value;

        // Save to localStorage
        localStorage.setItem('changebot:toast:position', position);

        toast.setAttribute('position', position);
        console.log('üìç Changed automatic toast position to:', position);
        updateStatus(`Changed position to ${position}`);
      }

      // Apply saved theme and position on load
      function applySavedPreferences() {
        const automaticToast = document.getElementById('toast-automatic');
        const themeSelect = document.getElementById('theme-select');
        const positionSelect = document.getElementById('position-select');

        // Apply saved theme to all toasts
        const savedTheme = localStorage.getItem('changebot:toast:theme');
        if (themeSelect) themeSelect.value = savedTheme || '';

        const toasts = document.querySelectorAll('changebot-toast');
        toasts.forEach(toast => {
          if (savedTheme !== null) {
            if (savedTheme === '') {
              toast.removeAttribute('theme');
              toast.setAttribute('light', 'catppuccin-latte');
              toast.setAttribute('dark', 'catppuccin-mocha');
            } else {
              toast.removeAttribute('light');
              toast.removeAttribute('dark');
              toast.setAttribute('theme', savedTheme);
            }
          } else {
            // Default to system auto
            toast.setAttribute('light', 'catppuccin-latte');
            toast.setAttribute('dark', 'catppuccin-mocha');
          }
        });

        // Apply saved position (only to automatic toast)
        if (automaticToast) {
          const savedPosition = localStorage.getItem('changebot:toast:position');
          if (savedPosition) {
            if (positionSelect) positionSelect.value = savedPosition;
            automaticToast.setAttribute('position', savedPosition);
          }
        }
      }

      // Log store state for debugging
      function logStore() {
        const event = new CustomEvent('changebot:context-request', {
          detail: {
            callback: services => {
              console.log('üìä Store State:', services.store.state);
              console.log('üì¶ Updates:', services.store.state.updates);
              console.log('üî¢ New Updates Count:', services.store.state.newUpdatesCount);
              if (services.store.state.lastViewed) {
                console.log('‚è∞ Last Viewed:', new Date(services.store.state.lastViewed));
              }
              updateStatus('Store state logged to console');
            },
            scope: 'default'
          },
          bubbles: true,
          composed: true
        });
        document.dispatchEvent(event);
      }

      // Update status message
      function updateStatus(message) {
        const status = document.getElementById('status');
        status.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
        status.style.display = 'block';

        setTimeout(() => {
          status.style.display = 'none';
        }, 3000);
      }

      // Event listeners for debugging
      document.addEventListener('changebot:context-request', e => {
        console.log('üîÑ Context Request:', e.detail);
      });

      document.addEventListener('changebot:action', e => {
        console.log('‚ö° Action Dispatched:', e.detail);
      });

      // Log when ready
      window.addEventListener('load', () => {
        console.log('‚úÖ Changebot toast demo loaded');
        console.log('üçû Toast will automatically show new updates');
        console.log('üí° Use the buttons above to test different positions');

        // Apply saved preferences (theme and position)
        applySavedPreferences();
      });
    </script>
  </body>
</html>
