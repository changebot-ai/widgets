<!doctype html>
<html dir="ltr" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production Demo - Changebot Widgets (CDN)</title>

  <!-- Load from production CDN -->
  <script type="module" src="https://widgets.changebot.ai/latest/widgets.esm.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
    }

    .demo-header {
      background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
      color: white;
      padding: 24px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .demo-header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .demo-header .badge-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .demo-header .badge-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .control-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .control-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .control-row:last-child {
      margin-bottom: 0;
    }

    .control-row label {
      min-width: 120px;
      font-size: 13px;
      color: #555;
    }

    .control-row select,
    .control-row input[type="text"],
    .control-row input[type="datetime-local"] {
      flex: 1;
      min-width: 0;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      background: white;
    }

    .control-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .control-row .btn {
      flex-shrink: 0;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #f56565;
      color: white;
    }

    .btn-primary:hover {
      background: #e53e3e;
    }

    .btn-secondary {
      background: #e9ecef;
      color: #495057;
    }

    .btn-secondary:hover {
      background: #dee2e6;
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-success:hover {
      background: #38a169;
    }

    .btn-warning {
      background: #ed8936;
      color: white;
    }

    .btn-warning:hover {
      background: #dd6b20;
    }

    .btn-danger {
      background: #e53e3e;
      color: white;
    }

    .btn-danger:hover {
      background: #c53030;
    }

    .debug-panel {
      background: #2d3748;
      color: #fc8181;
      border-radius: 12px;
      padding: 20px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      margin-top: 24px;
    }

    .debug-panel h3 {
      color: #fc8181;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .debug-row {
      display: flex;
      margin-bottom: 8px;
    }

    .debug-label {
      color: #feb2b2;
      min-width: 180px;
    }

    .debug-value {
      color: #68d391;
    }

    .debug-value.warning {
      color: #fbd38d;
    }

    .prod-note {
      background: #fff5f5;
      color: #c53030;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      font-size: 13px;
      border-left: 4px solid #f56565;
    }

    .prod-note strong {
      color: #9b2c2c;
    }

    .prod-note code {
      background: #fed7d7;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }

    .api-status {
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 13px;
      margin-bottom: 16px;
    }

    .api-status.loading {
      background: #fefcbf;
      color: #744210;
    }

    .api-status.success {
      background: #c6f6d5;
      color: #22543d;
    }

    .api-status.error {
      background: #fed7d7;
      color: #9b2c2c;
    }
  </style>
</head>

<body>
  <!-- Provider with real API - no mock data -->
  <changebot-provider id="provider" scope="production-demo"></changebot-provider>

  <!-- Banner -->
  <div id="banner-container">
    <changebot-banner id="banner" scope="production-demo" position="top"></changebot-banner>
  </div>

  <header class="demo-header">
    <h1>Production Demo (CDN)</h1>
    <div class="badge-wrapper">
      <span class="badge-label">Updates:</span>
      <div id="badge-container">
        <changebot-badge id="badge" scope="production-demo" show-count="true"></changebot-badge>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="prod-note">
      <strong>Production Build:</strong> This page loads widgets from
      <code>https://widgets.changebot.ai/latest/</code> and connects to the real API.
      No mock data is used.
    </div>

    <div id="api-status" class="api-status loading">Connecting to API...</div>

    <div class="controls-grid">
      <!-- Widget Slug -->
      <div class="control-section">
        <h3>Widget Configuration</h3>
        <div class="control-row">
          <label>Slug:</label>
          <input type="text" id="slugInput" value="d4505ac70f7c131df7c1e919" />
          <button class="btn btn-primary" onclick="updateSlug()">Apply</button>
        </div>
        <p style="font-size: 12px; color: #888; margin-top: 8px;">
          Change the slug to test different widgets. Requires page reload.
        </p>
      </div>

      <!-- Last Viewed Time Controls -->
      <div class="control-section">
        <h3>Last Viewed Time</h3>
        <div class="button-row">
          <button class="btn btn-secondary" onclick="setLastViewed('now')">Now</button>
          <button class="btn btn-secondary" onclick="setLastViewed('1day')">1 Day Ago</button>
          <button class="btn btn-secondary" onclick="setLastViewed('7days')">7 Days</button>
          <button class="btn btn-secondary" onclick="setLastViewed('30days')">30 Days</button>
          <button class="btn btn-secondary" onclick="setLastViewed('90days')">90 Days</button>
          <button class="btn btn-danger" onclick="setLastViewed('clear')">Clear</button>
        </div>
        <div class="control-row" style="margin-top: 12px;">
          <label>Custom:</label>
          <input type="datetime-local" id="customDate" />
          <button class="btn btn-primary" onclick="setCustomDate()">Set</button>
        </div>
      </div>

      <!-- Theme Controls -->
      <div class="control-section">
        <h3>Theme</h3>
        <div class="control-row">
          <label>Mode:</label>
          <select id="themeMode" onchange="updateTheme()">
            <option value="fixed">Fixed Theme</option>
            <option value="auto">Light/Dark Auto</option>
          </select>
        </div>
        <div class="control-row" id="fixedThemeRow">
          <label>Theme:</label>
          <select id="fixedTheme" onchange="updateTheme()">
            <optgroup label="Light Themes">
              <option value="catppuccin-latte">Catppuccin Latte</option>
              <option value="gruvbox-light">Gruvbox Light</option>
              <option value="solarized-light">Solarized Light</option>
              <option value="everforest-light">Everforest Light</option>
              <option value="frost">Frost</option>
            </optgroup>
            <optgroup label="Dark Themes">
              <option value="catppuccin-frappe">Catppuccin Frappe</option>
              <option value="catppuccin-macchiato">Catppuccin Macchiato</option>
              <option value="catppuccin-mocha" selected>Catppuccin Mocha</option>
              <option value="gruvbox-dark">Gruvbox Dark</option>
              <option value="dracula">Dracula</option>
              <option value="nord">Nord</option>
              <option value="solarized-dark">Solarized Dark</option>
              <option value="everforest-dark">Everforest Dark</option>
              <option value="tokyo-night">Tokyo Night</option>
              <option value="cyberpunk">Cyberpunk</option>
            </optgroup>
          </select>
        </div>
        <div class="control-row" id="lightThemeRow" style="display: none;">
          <label>Light Theme:</label>
          <select id="lightTheme" onchange="updateTheme()">
            <option value="catppuccin-latte" selected>Catppuccin Latte</option>
            <option value="gruvbox-light">Gruvbox Light</option>
            <option value="solarized-light">Solarized Light</option>
            <option value="everforest-light">Everforest Light</option>
            <option value="frost">Frost</option>
          </select>
        </div>
        <div class="control-row" id="darkThemeRow" style="display: none;">
          <label>Dark Theme:</label>
          <select id="darkTheme" onchange="updateTheme()">
            <option value="catppuccin-frappe">Catppuccin Frappe</option>
            <option value="catppuccin-macchiato">Catppuccin Macchiato</option>
            <option value="catppuccin-mocha" selected>Catppuccin Mocha</option>
            <option value="gruvbox-dark">Gruvbox Dark</option>
            <option value="dracula">Dracula</option>
            <option value="nord">Nord</option>
            <option value="solarized-dark">Solarized Dark</option>
            <option value="everforest-dark">Everforest Dark</option>
            <option value="tokyo-night">Tokyo Night</option>
            <option value="cyberpunk">Cyberpunk</option>
          </select>
        </div>
      </div>

      <!-- Component Visibility -->
      <div class="control-section">
        <h3>Components</h3>
        <div class="control-row">
          <input type="checkbox" id="showBadge" checked onchange="toggleComponent('badge')" />
          <label>Badge</label>
          <input type="checkbox" id="badgeShowCount" checked onchange="updateBadge()" style="margin-left: auto;" />
          <label style="min-width: auto;">Show Count</label>
        </div>
        <div class="control-row">
          <input type="checkbox" id="showPanel" checked onchange="toggleComponent('panel')" />
          <label>Panel</label>
          <select id="panelMode" onchange="updatePanel()" style="margin-left: auto; flex: none; width: 140px;">
            <option value="drawer-right" selected>Drawer Right</option>
            <option value="drawer-left">Drawer Left</option>
            <option value="modal">Modal</option>
          </select>
        </div>
        <div class="control-row">
          <input type="checkbox" id="showBanner" checked onchange="toggleComponent('banner')" />
          <label>Banner</label>
          <select id="bannerPosition" onchange="updateBanner()" style="margin-left: auto; flex: none; width: 140px;">
            <option value="top" selected>Top</option>
            <option value="bottom">Bottom</option>
          </select>
        </div>
        <div class="control-row">
          <input type="checkbox" id="showToast" checked onchange="toggleComponent('toast')" />
          <label>Toast</label>
          <select id="toastPosition" onchange="updateToast()" style="margin-left: auto; flex: none; width: 140px;">
            <option value="bottom-right" selected>Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
          </select>
        </div>
      </div>

      <!-- Actions -->
      <div class="control-section">
        <h3>Actions</h3>
        <div class="button-row">
          <button class="btn btn-primary" onclick="openPanel()">Open Panel</button>
          <button class="btn btn-success" onclick="showToast()">Show Toast</button>
          <button class="btn btn-warning" onclick="showBanner()">Show Banner</button>
        </div>
        <div class="button-row" style="margin-top: 12px;">
          <button class="btn btn-secondary" onclick="refreshDebug()">Refresh Debug</button>
          <button class="btn btn-danger" onclick="resetAll()">Reset All</button>
        </div>
      </div>

      <!-- Preview Mode -->
      <div class="control-section">
        <h3>Preview Mode (CSS Development)</h3>
        <p style="font-size: 12px; color: #666; margin-bottom: 12px;">
          Show toast/banner with mock content - no provider needed. Useful for styling.
        </p>
        <div class="button-row">
          <button class="btn btn-success" id="previewToastBtn" onclick="togglePreviewToast()">Show Preview Toast</button>
          <button class="btn btn-warning" id="previewBannerBtn" onclick="togglePreviewBanner()">Show Preview Banner</button>
        </div>
      </div>
    </div>

    <!-- Debug Panel -->
    <div class="debug-panel">
      <h3>Debug Info</h3>
      <div class="debug-row">
        <span class="debug-label">Current Slug:</span>
        <span class="debug-value" id="debug-slug">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">Last Viewed (raw):</span>
        <span class="debug-value" id="debug-lastviewed-raw">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">Last Viewed (formatted):</span>
        <span class="debug-value" id="debug-lastviewed">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">Current Theme:</span>
        <span class="debug-value" id="debug-theme">-</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">localStorage Key:</span>
        <span class="debug-value">changebot:lastViewed:production-demo</span>
      </div>
      <div class="debug-row">
        <span class="debug-label">CDN URL:</span>
        <span class="debug-value">https://widgets.changebot.ai/latest/</span>
      </div>
    </div>
  </div>

  <!-- Panel Component -->
  <div id="panel-container">
    <changebot-panel id="panel" scope="production-demo" mode="drawer-right"></changebot-panel>
  </div>

  <!-- Toast Component -->
  <div id="toast-container">
    <changebot-toast id="toast" scope="production-demo" position="bottom-right"></changebot-toast>
  </div>

  <script>
    const SCOPE = 'production-demo';
    const LS_KEY = `changebot:lastViewed:${SCOPE}`;
    const SLUG_KEY = 'changebot:demo:slug';

    // Get saved slug or use default
    function getSavedSlug() {
      return localStorage.getItem(SLUG_KEY) || 'd4505ac70f7c131df7c1e919';
    }

    // Initialize provider with slug
    function initProvider() {
      const slug = getSavedSlug();
      const provider = document.getElementById('provider');
      if (provider) {
        provider.setAttribute('slug', slug);
      }
      document.getElementById('slugInput').value = slug;

      // Check API status after a delay
      setTimeout(checkApiStatus, 2000);
    }

    // Update slug
    function updateSlug() {
      const newSlug = document.getElementById('slugInput').value.trim();
      if (newSlug) {
        localStorage.setItem(SLUG_KEY, newSlug);
        location.reload();
      }
    }

    // Check API connection status
    function checkApiStatus() {
      const statusEl = document.getElementById('api-status');
      const slug = getSavedSlug();

      // Try to check if we got data by looking at the panel
      const panel = document.getElementById('panel');
      // Simple heuristic - if no errors in console, assume success
      statusEl.className = 'api-status success';
      statusEl.innerHTML = `<strong>Connected:</strong> Using widget slug "${slug}"`;
    }

    // Last Viewed Controls
    function setLastViewed(period) {
      const now = Date.now();
      const day = 24 * 60 * 60 * 1000;
      let timestamp;

      switch (period) {
        case 'now':
          timestamp = now;
          break;
        case '1day':
          timestamp = now - day;
          break;
        case '7days':
          timestamp = now - 7 * day;
          break;
        case '30days':
          timestamp = now - 30 * day;
          break;
        case '90days':
          timestamp = now - 90 * day;
          break;
        case 'clear':
          localStorage.removeItem(LS_KEY);
          location.reload();
          return;
      }

      localStorage.setItem(LS_KEY, timestamp.toString());
      location.reload();
    }

    function setCustomDate() {
      const input = document.getElementById('customDate');
      if (input.value) {
        const timestamp = new Date(input.value).getTime();
        localStorage.setItem(LS_KEY, timestamp.toString());
        location.reload();
      }
    }

    // Theme Controls
    function updateTheme() {
      const mode = document.getElementById('themeMode').value;
      const fixedRow = document.getElementById('fixedThemeRow');
      const lightRow = document.getElementById('lightThemeRow');
      const darkRow = document.getElementById('darkThemeRow');

      if (mode === 'fixed') {
        fixedRow.style.display = 'flex';
        lightRow.style.display = 'none';
        darkRow.style.display = 'none';

        const theme = document.getElementById('fixedTheme').value;
        applyThemeToComponents(theme, null, null);
      } else {
        fixedRow.style.display = 'none';
        lightRow.style.display = 'flex';
        darkRow.style.display = 'flex';

        const light = document.getElementById('lightTheme').value;
        const dark = document.getElementById('darkTheme').value;
        applyThemeToComponents(null, light, dark);
      }

      refreshDebug();
    }

    function applyThemeToComponents(fixed, light, dark) {
      const components = ['badge', 'panel', 'banner', 'toast'];

      components.forEach(comp => {
        const el = document.getElementById(comp);
        if (el) {
          if (fixed) {
            el.setAttribute('theme', fixed);
            el.removeAttribute('light');
            el.removeAttribute('dark');
          } else {
            el.removeAttribute('theme');
            el.setAttribute('light', light);
            el.setAttribute('dark', dark);
          }
        }
      });
    }

    // Component Visibility
    function toggleComponent(comp) {
      const checkbox = document.getElementById('show' + comp.charAt(0).toUpperCase() + comp.slice(1));
      const container = document.getElementById(comp + '-container');

      if (comp === 'badge') {
        const badgeContainer = document.getElementById('badge-container');
        badgeContainer.style.display = checkbox.checked ? 'block' : 'none';
      } else if (container) {
        container.style.display = checkbox.checked ? 'block' : 'none';
      }
    }

    function updateBadge() {
      const badge = document.getElementById('badge');
      const showCount = document.getElementById('badgeShowCount').checked;
      if (badge) {
        badge.setAttribute('show-count', showCount.toString());
      }
    }

    function updatePanel() {
      const panel = document.getElementById('panel');
      const mode = document.getElementById('panelMode').value;
      if (panel) {
        panel.setAttribute('mode', mode);
      }
    }

    function updateBanner() {
      const banner = document.getElementById('banner');
      const position = document.getElementById('bannerPosition').value;
      if (banner) {
        banner.setAttribute('position', position);
      }
    }

    function updateToast() {
      const toast = document.getElementById('toast');
      const position = document.getElementById('toastPosition').value;
      if (toast) {
        toast.setAttribute('position', position);
      }
    }

    // Actions
    function openPanel() {
      document.dispatchEvent(new CustomEvent('changebot:action', {
        detail: { type: 'openDisplay', scope: SCOPE },
        bubbles: true,
        composed: true
      }));
    }

    async function showToast() {
      const toast = document.getElementById('toast');
      if (toast && toast.show) {
        // For production, we'd need to get an update from the API
        // For now, just trigger the action event
        document.dispatchEvent(new CustomEvent('changebot:action', {
          detail: { type: 'showToast', scope: SCOPE },
          bubbles: true,
          composed: true
        }));
      }
    }

    async function showBanner() {
      const banner = document.getElementById('banner');
      if (banner && banner.show) {
        document.dispatchEvent(new CustomEvent('changebot:action', {
          detail: { type: 'showBanner', scope: SCOPE },
          bubbles: true,
          composed: true
        }));
      }
    }

    function resetAll() {
      localStorage.removeItem(LS_KEY);
      localStorage.removeItem(SLUG_KEY);
      location.reload();
    }

    // Preview Mode
    let previewToast = null;
    let previewBanner = null;

    function togglePreviewToast() {
      const btn = document.getElementById('previewToastBtn');
      if (previewToast) {
        previewToast.remove();
        previewToast = null;
        btn.textContent = 'Show Preview Toast';
        btn.classList.remove('btn-danger');
        btn.classList.add('btn-success');
      } else {
        previewToast = document.createElement('changebot-toast');
        previewToast.setAttribute('preview', 'true');
        previewToast.setAttribute('position', document.getElementById('toastPosition').value);
        // Apply current theme
        const mode = document.getElementById('themeMode').value;
        if (mode === 'fixed') {
          previewToast.setAttribute('theme', document.getElementById('fixedTheme').value);
        } else {
          previewToast.setAttribute('light', document.getElementById('lightTheme').value);
          previewToast.setAttribute('dark', document.getElementById('darkTheme').value);
        }
        document.body.appendChild(previewToast);
        btn.textContent = 'Hide Preview Toast';
        btn.classList.remove('btn-success');
        btn.classList.add('btn-danger');
      }
    }

    function togglePreviewBanner() {
      const btn = document.getElementById('previewBannerBtn');
      if (previewBanner) {
        previewBanner.remove();
        previewBanner = null;
        btn.textContent = 'Show Preview Banner';
        btn.classList.remove('btn-danger');
        btn.classList.add('btn-warning');
      } else {
        previewBanner = document.createElement('changebot-banner');
        previewBanner.setAttribute('preview', 'true');
        // Apply current theme
        const mode = document.getElementById('themeMode').value;
        if (mode === 'fixed') {
          previewBanner.setAttribute('theme', document.getElementById('fixedTheme').value);
        } else {
          previewBanner.setAttribute('light', document.getElementById('lightTheme').value);
          previewBanner.setAttribute('dark', document.getElementById('darkTheme').value);
        }
        document.body.insertBefore(previewBanner, document.body.firstChild);
        btn.textContent = 'Hide Preview Banner';
        btn.classList.remove('btn-warning');
        btn.classList.add('btn-danger');
      }
    }

    // Debug
    function refreshDebug() {
      const raw = localStorage.getItem(LS_KEY);
      const debugSlug = document.getElementById('debug-slug');
      const debugRaw = document.getElementById('debug-lastviewed-raw');
      const debugFormatted = document.getElementById('debug-lastviewed');
      const debugTheme = document.getElementById('debug-theme');

      debugSlug.textContent = getSavedSlug();
      debugRaw.textContent = raw || '(not set)';
      debugRaw.className = 'debug-value' + (raw ? '' : ' warning');

      if (raw) {
        const date = new Date(parseInt(raw));
        debugFormatted.textContent = date.toLocaleString();
      } else {
        debugFormatted.textContent = '(not set - first visit behavior)';
        debugFormatted.className = 'debug-value warning';
      }

      // Theme info
      const mode = document.getElementById('themeMode').value;
      if (mode === 'fixed') {
        debugTheme.textContent = document.getElementById('fixedTheme').value;
      } else {
        const light = document.getElementById('lightTheme').value;
        const dark = document.getElementById('darkTheme').value;
        debugTheme.textContent = `light: ${light}, dark: ${dark}`;
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initProvider();
      updateTheme();
      setTimeout(refreshDebug, 100);
    });
  </script>
</body>

</html>
