<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Changebot Panel & Badge - Production Example</title>

    <script type="module" src="/build/widgets.esm.js"></script>
    <script nomodule src="/build/widgets.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 40px;
        background: #f5f5f5;
        min-height: 100vh;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      h1 {
        margin-top: 0;
        color: #333;
      }

      h2 {
        color: #555;
        margin-top: 30px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 10px;
      }

      h3 {
        color: #666;
        margin-top: 20px;
      }

      code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
      }

      pre {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border-radius: 4px;
        overflow-x: auto;
        font-family: 'Courier New', monospace;
        margin: 20px 0;
      }

      pre code {
        background: none;
        padding: 0;
        color: inherit;
        font-size: 14px;
      }

      button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
        font-size: 14px;
      }

      button:hover {
        background: #0056b3;
      }

      button.secondary {
        background: #6c757d;
      }

      button.secondary:hover {
        background: #545b62;
      }

      .controls {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 4px;
      }

      .controls h3 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 16px;
        color: #333;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .demo-card {
        padding: 15px;
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
      }

      .demo-card h4 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 14px;
        color: #666;
      }

      .demo-card button {
        width: 100%;
        margin: 0;
      }

      .info-box {
        background: #e7f3ff;
        border: 1px solid #b3d9ff;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
      }

      .info-box p {
        margin: 5px 0;
      }

      .status {
        padding: 12px;
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
        color: #155724;
        margin: 15px 0;
        font-size: 14px;
      }

      .example-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        background: #2c3e50;
        color: white;
        border-radius: 6px;
        margin: 20px 0;
      }

      .example-header h3 {
        margin: 0;
        color: white;
      }

      a {
        color: #007bff;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        padding: 8px 16px;
        background: #f0f0f0;
        border-radius: 4px;
        color: #333;
      }

      .back-link:hover {
        background: #e0e0e0;
        text-decoration: none;
      }

      ul {
        line-height: 1.8;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      th {
        text-align: left;
        padding: 10px;
        background: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
        font-weight: 600;
      }

      td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
      }
    </style>
  </head>
  <body>
    <!-- Provider Component - Fetches updates from Changebot API -->
    <changebot-provider slug="changebot" poll-interval="30"></changebot-provider>

    <!-- Panel Component - Opens when badge is clicked -->
    <changebot-panel id="panel-demo" display-mode="drawer-right"></changebot-panel>

    <div class="container">
      <a href="/" class="back-link">‚Üê Back to Index</a>

      <h1>Changebot Panel & Badge - Production Example</h1>
      <p>The panel displays product updates in a drawer or modal view. The badge shows the count of unread updates and opens the panel when clicked.</p>

      <div class="info-box">
        <p><strong>Live Demo:</strong> Connected to production Changebot API (<code>api.changebot.ai</code>) and will show live updates.</p>
        <p><strong>Polling:</strong> Checks for new updates every 30 seconds.</p>
        <p><strong>Auto-Badge:</strong> The badge count updates automatically when new updates are available.</p>
        <p><strong>Click Badge:</strong> Click the badge in the demo header below to open the panel.</p>
        <p><strong>Testing Tip:</strong> Use the "Last Seen Management" controls below to simulate different scenarios.</p>
      </div>

      <!-- Demo Header with Badge -->
      <div class="example-header">
        <h3>Your App Header</h3>
        <changebot-badge scope="default"></changebot-badge>
      </div>

      <p>Features:</p>
      <ul>
        <li>üéØ Badge displays count of unread updates</li>
        <li>üì± Three display modes: drawer-left, drawer-right, modal</li>
        <li>üñ±Ô∏è Click badge to open panel automatically</li>
        <li>‚å®Ô∏è Keyboard accessible (ESC to close, Tab for focus trap)</li>
        <li>üé® Theme support with auto light/dark mode detection</li>
        <li>üîÑ Works seamlessly with provider for automatic updates</li>
        <li>üé≠ Backdrop click to close (drawer and modal modes)</li>
      </ul>

      <h2>Manual Control</h2>
      <p>You can open the panel programmatically using JavaScript:</p>

      <div class="controls">
        <h3>Direct Panel Control</h3>
        <button onclick="openPanel()">Open Panel</button>
        <button onclick="closePanel()">Close Panel</button>
        <button onclick="setMockUpdates()">Load Mock Updates</button>
        <button class="secondary" onclick="clearUpdates()">Clear Updates</button>
      </div>

      <div class="controls">
        <h3>Via Event Dispatch (works with provider)</h3>
        <button onclick="dispatchOpenPanel()">Dispatch Open Event</button>
        <button onclick="dispatchClosePanel()">Dispatch Close Event</button>
      </div>

      <div class="controls">
        <h3>Display Modes</h3>
        <button onclick="setDisplayMode('drawer-left')">Drawer Left</button>
        <button onclick="setDisplayMode('drawer-right')">Drawer Right</button>
        <button onclick="setDisplayMode('modal')">Modal</button>
      </div>

      <div class="controls">
        <h3>Last Seen Management</h3>
        <button onclick="clearLastViewed()">Clear Last Viewed & Reload</button>
        <button onclick="setToOneHourAgo()">Set to 1 Hour Ago</button>
        <button onclick="setToYesterday()">Set to Yesterday</button>
        <button class="secondary" onclick="logStoreState()">Log Store State</button>
      </div>

      <div class="controls">
        <h3>Theme Demos</h3>
        <div class="demo-grid">
          <div class="demo-card">
            <h4>Default Theme</h4>
            <button onclick="setTheme(null)">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Catppuccin Latte</h4>
            <button onclick="setTheme('catppuccin-latte')">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Catppuccin Mocha</h4>
            <button onclick="setTheme('catppuccin-mocha')">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Gruvbox Dark</h4>
            <button onclick="setTheme('gruvbox-dark')">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Dracula</h4>
            <button onclick="setTheme('dracula')">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Nord</h4>
            <button onclick="setTheme('nord')">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Tokyo Night</h4>
            <button onclick="setTheme('tokyo-night')">Apply Theme</button>
          </div>
          <div class="demo-card">
            <h4>Cyberpunk</h4>
            <button onclick="setTheme('cyberpunk')">Apply Theme</button>
          </div>
        </div>
      </div>

      <h2>Usage</h2>

      <h3>Basic Setup</h3>
      <pre><code>&lt;!-- Provider Component --&gt;
&lt;changebot-provider slug="your-slug" poll-interval="30"&gt;&lt;/changebot-provider&gt;

&lt;!-- Badge in header --&gt;
&lt;changebot-badge&gt;&lt;/changebot-badge&gt;

&lt;!-- Panel (hidden until opened) --&gt;
&lt;changebot-panel display-mode="drawer-right"&gt;&lt;/changebot-panel&gt;</code></pre>

      <h3>Opening Panel Programmatically</h3>
      <pre><code>// Get panel reference
const panel = document.querySelector('changebot-panel');

// Open the panel
await panel.open();

// Close the panel
await panel.close();

// Set custom updates
await panel.setUpdates([
  {
    id: '1',
    title: 'New Feature',
    description: 'Description...',
    date: '2024-01-01',
    timestamp: Date.now()
  }
]);</code></pre>

      <h3>Opening Panel via Custom Event</h3>
      <p>This method works with the provider and allows any element to open the panel:</p>
      <pre><code>&lt;!-- Custom button anywhere on your page --&gt;
&lt;button onclick="openUpdatesPanel()"&gt;View Updates&lt;/button&gt;

&lt;script&gt;
  function openUpdatesPanel() {
    const event = new CustomEvent('changebot:action', {
      detail: {
        type: 'openDisplay',
        scope: 'default' // match panel's scope
      },
      bubbles: true,
      composed: true
    });
    document.dispatchEvent(event);
  }
&lt;/script&gt;</code></pre>

      <h3>With Theme</h3>
      <pre><code>&lt;!-- Fixed theme --&gt;
&lt;changebot-badge theme="catppuccin-mocha"&gt;&lt;/changebot-badge&gt;
&lt;changebot-panel theme="catppuccin-mocha" display-mode="drawer-right"&gt;&lt;/changebot-panel&gt;

&lt;!-- Auto light/dark mode --&gt;
&lt;changebot-badge
  light="catppuccin-latte"
  dark="catppuccin-mocha"&gt;
&lt;/changebot-badge&gt;
&lt;changebot-panel
  light="catppuccin-latte"
  dark="catppuccin-mocha"
  display-mode="drawer-right"&gt;
&lt;/changebot-panel&gt;</code></pre>

      <h3>With Custom Scope</h3>
      <pre><code>&lt;!-- Multiple independent systems --&gt;
&lt;changebot-provider slug="product-updates" scope="product"&gt;&lt;/changebot-provider&gt;
&lt;changebot-badge scope="product"&gt;&lt;/changebot-badge&gt;
&lt;changebot-panel scope="product"&gt;&lt;/changebot-panel&gt;

&lt;changebot-provider slug="blog-posts" scope="blog"&gt;&lt;/changebot-provider&gt;
&lt;changebot-badge scope="blog"&gt;&lt;/changebot-badge&gt;
&lt;changebot-panel scope="blog" display-mode="modal"&gt;&lt;/changebot-panel&gt;</code></pre>

      <h2>Panel Props</h2>

      <table>
        <thead>
          <tr>
            <th>Prop</th>
            <th>Type</th>
            <th>Default</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>scope</code></td>
            <td>string</td>
            <td>"default"</td>
            <td>Connect to provider with matching scope</td>
          </tr>
          <tr>
            <td><code>displayMode</code></td>
            <td>string</td>
            <td>"drawer-right"</td>
            <td>Display mode: "drawer-left", "drawer-right", or "modal"</td>
          </tr>
          <tr>
            <td><code>theme</code></td>
            <td>Theme</td>
            <td>-</td>
            <td>Fixed color theme</td>
          </tr>
          <tr>
            <td><code>light</code></td>
            <td>Theme</td>
            <td>-</td>
            <td>Theme for light mode (auto-switches)</td>
          </tr>
          <tr>
            <td><code>dark</code></td>
            <td>Theme</td>
            <td>-</td>
            <td>Theme for dark mode (auto-switches)</td>
          </tr>
        </tbody>
      </table>

      <h2>Panel Methods</h2>

      <table>
        <thead>
          <tr>
            <th>Method</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>open()</code></td>
            <td>Open the panel</td>
          </tr>
          <tr>
            <td><code>close()</code></td>
            <td>Close the panel</td>
          </tr>
          <tr>
            <td><code>setUpdates(updates)</code></td>
            <td>Manually set the updates to display</td>
          </tr>
        </tbody>
      </table>

      <h2>Badge Props</h2>

      <table>
        <thead>
          <tr>
            <th>Prop</th>
            <th>Type</th>
            <th>Default</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>scope</code></td>
            <td>string</td>
            <td>"default"</td>
            <td>Connect to provider with matching scope</td>
          </tr>
          <tr>
            <td><code>count</code></td>
            <td>number</td>
            <td>0</td>
            <td>Manual count (overrides provider count)</td>
          </tr>
          <tr>
            <td><code>showCount</code></td>
            <td>boolean</td>
            <td>true</td>
            <td>Show/hide the count number</td>
          </tr>
          <tr>
            <td><code>theme</code></td>
            <td>Theme</td>
            <td>-</td>
            <td>Fixed color theme</td>
          </tr>
          <tr>
            <td><code>light</code></td>
            <td>Theme</td>
            <td>-</td>
            <td>Theme for light mode (auto-switches)</td>
          </tr>
          <tr>
            <td><code>dark</code></td>
            <td>Theme</td>
            <td>-</td>
            <td>Theme for dark mode (auto-switches)</td>
          </tr>
        </tbody>
      </table>

      <h2>Available Themes</h2>
      <ul>
        <li>Catppuccin: <code>catppuccin-latte</code>, <code>catppuccin-frappe</code>, <code>catppuccin-macchiato</code>, <code>catppuccin-mocha</code></li>
        <li>Gruvbox: <code>gruvbox-light</code>, <code>gruvbox-dark</code></li>
        <li>Dracula: <code>dracula</code></li>
        <li>Nord: <code>nord</code></li>
        <li>Solarized: <code>solarized-light</code>, <code>solarized-dark</code></li>
        <li>Everforest: <code>everforest-light</code>, <code>everforest-dark</code></li>
        <li>Tokyo Night: <code>tokyo-night</code></li>
        <li>Cyberpunk: <code>cyberpunk</code></li>
      </ul>

      <div class="status">
        ‚úÖ Connected to production Changebot API (api.changebot.ai). Click the badge or use the controls above to test the panel.
      </div>
    </div>

    <script>
      // Get panel element
      const panel = document.getElementById('panel-demo');

      // Mock update data
      const mockUpdates = [
        {
          id: 'demo-1',
          title: 'New Feature: Dark Mode',
          description: '<p>We\'ve added full dark mode support across all components!</p>',
          date: '2024-01-15',
          timestamp: Date.now(),
          tags: [
            { text: 'Feature', color: '#3b82f6' },
            { text: 'UI', color: '#8b5cf6' }
          ]
        },
        {
          id: 'demo-2',
          title: 'Performance Improvements',
          description: '<p>Loading times reduced by 50%.</p>',
          date: '2024-01-10',
          timestamp: Date.now() - 432000000,
          tags: [
            { text: 'Performance', color: '#10b981' }
          ]
        },
        {
          id: 'demo-3',
          title: 'Bug Fixes',
          description: '<p>Fixed several reported issues in the previous release.</p>',
          date: '2024-01-05',
          timestamp: Date.now() - 864000000,
          tags: [
            { text: 'Bug Fix', color: '#ef4444' }
          ]
        }
      ];

      // Direct panel control
      async function openPanel() {
        await panel.open();
      }

      async function closePanel() {
        await panel.close();
      }

      async function setMockUpdates() {
        await panel.setUpdates(mockUpdates);
        await panel.open();
      }

      async function clearUpdates() {
        await panel.setUpdates([]);
      }

      // Event-based control
      function dispatchOpenPanel() {
        const event = new CustomEvent('changebot:action', {
          detail: {
            type: 'openDisplay',
            scope: 'default'
          },
          bubbles: true,
          composed: true
        });
        document.dispatchEvent(event);
      }

      function dispatchClosePanel() {
        const event = new CustomEvent('changebot:action', {
          detail: {
            type: 'closeDisplay',
            scope: 'default'
          },
          bubbles: true,
          composed: true
        });
        document.dispatchEvent(event);
      }

      // Display mode control
      function setDisplayMode(mode) {
        panel.setAttribute('display-mode', mode);
        console.log('Display mode set to:', mode);
      }

      // Theme control
      function setTheme(theme) {
        const badge = document.querySelector('changebot-badge');
        if (theme) {
          panel.setAttribute('theme', theme);
          if (badge) badge.setAttribute('theme', theme);
        } else {
          panel.removeAttribute('theme');
          if (badge) badge.removeAttribute('theme');
        }
        console.log('Theme set to:', theme || 'default');
      }

      // Last viewed management
      const STORAGE_KEY = 'changebot:lastViewed:default';

      function clearLastViewed() {
        localStorage.removeItem(STORAGE_KEY);
        console.log('‚úÖ Cleared last viewed timestamp. Reloading...');
        setTimeout(() => location.reload(), 500);
      }

      function setToOneHourAgo() {
        const timestamp = Date.now() - (60 * 60 * 1000);
        localStorage.setItem(STORAGE_KEY, timestamp.toString());
        console.log('‚úÖ Set last viewed to 1 hour ago:', new Date(timestamp));
        setTimeout(() => location.reload(), 500);
      }

      function setToYesterday() {
        const timestamp = Date.now() - (24 * 60 * 60 * 1000);
        localStorage.setItem(STORAGE_KEY, timestamp.toString());
        console.log('‚úÖ Set last viewed to yesterday:', new Date(timestamp));
        setTimeout(() => location.reload(), 500);
      }

      function logStoreState() {
        const lastViewed = localStorage.getItem(STORAGE_KEY);
        console.group('üìä Changebot Store State');
        console.log('Last Viewed (raw):', lastViewed);
        if (lastViewed) {
          console.log('Last Viewed (date):', new Date(parseInt(lastViewed)));
        }
        console.log('All Changebot localStorage keys:', Object.keys(localStorage).filter(k => k.startsWith('changebot')));
        console.groupEnd();
      }
    </script>
  </body>
</html>
