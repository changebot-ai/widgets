<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
  <title>Changebot Widgets - Component Testing</title>

  <script type="module" src="/build/widgets.esm.js"></script>
  <script nomodule src="/build/widgets.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    section {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    h1 {
      margin-top: 0;
      color: #333;
    }

    h2 {
      color: #666;
      font-size: 18px;
      margin-top: 0;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
    }

    h3 {
      margin-top: 0;
      font-size: 14px;
      color: #777;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .demo-grid {
      display: grid;
      gap: 20px;
      margin: 20px 0;
    }

    .demo-item {
      padding: 20px;
      background: #f9f9f9;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .badge-demos {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge-demo {
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      min-width: 120px;
      text-align: center;
    }

    .badge-demo-dark {
      background: #333;
      color: white;
    }

    button {
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      background: #0056b3;
    }

    button.danger {
      background: #dc3545;
    }

    button.danger:hover {
      background: #c82333;
    }

    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 13px;
    }

    .status {
      padding: 10px;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 4px;
      color: #155724;
      margin: 10px 0;
    }

    .controls {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 4px;
    }

    .info-box {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 4px;
      padding: 12px;
      margin: 15px 0;
    }

    .info-box strong {
      color: #004085;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
      font-size: 13px;
      color: #495057;
    }

    td code {
      background: #fff3cd;
      color: #856404;
    }
  </style>
</head>
<body>
  <!-- No provider here - we'll test with manual props and events -->

  <div class="container">
    <section>
      <h1>ðŸ§ª Changebot Widgets - Component Testing</h1>
      <p>Manual testing interface for all widget features without API calls.</p>
      <div class="info-box">
        <strong>Test Mode:</strong> Using manual props and events - no API calls
      </div>
    </section>

    <!-- Basic Badge Examples -->
    <section>
      <h2>Basic Badge Component</h2>

      <div class="demo-grid">
        <div class="demo-item">
          <h3>Default Badge</h3>
          <p>Standard badge with manual count</p>
          <changebot-badge count="3"></changebot-badge>
          <code>&lt;changebot-badge count="3"&gt;&lt;/changebot-badge&gt;</code>
        </div>

        <div class="demo-item">
          <h3>Theme Variations</h3>
          <div class="badge-demos">
            <div class="badge-demo">
              <p>Default</p>
              <changebot-badge count="5"></changebot-badge>
            </div>
            <div class="badge-demo badge-demo-dark">
              <p>Light</p>
              <changebot-badge theme="light" count="5"></changebot-badge>
            </div>
            <div class="badge-demo">
              <p>Dark</p>
              <changebot-badge theme="dark" count="5"></changebot-badge>
            </div>
          </div>
        </div>

        <div class="demo-item">
          <h3>Count Display Options</h3>
          <div class="badge-demos">
            <div class="badge-demo">
              <p>With Count (default)</p>
              <changebot-badge count="7"></changebot-badge>
            </div>
            <div class="badge-demo">
              <p>No Count (dot only)</p>
              <changebot-badge show-count="false" count="7"></changebot-badge>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Manual Count Testing -->
    <section>
      <h2>Manual Count Testing (No Provider)</h2>
      <p>These badges use manual count props for testing different states:</p>

      <div class="badge-demos">
        <div class="badge-demo">
          <p>0 updates</p>
          <changebot-badge count="0"></changebot-badge>
        </div>
        <div class="badge-demo">
          <p>1 update</p>
          <changebot-badge count="1"></changebot-badge>
        </div>
        <div class="badge-demo">
          <p>5 updates</p>
          <changebot-badge count="5"></changebot-badge>
        </div>
        <div class="badge-demo">
          <p>42 updates</p>
          <changebot-badge count="42"></changebot-badge>
        </div>
        <div class="badge-demo">
          <p>9 updates</p>
          <changebot-badge count="9"></changebot-badge>
        </div>
        <div class="badge-demo">
          <p>10 (shows 9+)</p>
          <changebot-badge count="10"></changebot-badge>
        </div>
        <div class="badge-demo">
          <p>99 (shows 9+)</p>
          <changebot-badge count="99"></changebot-badge>
        </div>
      </div>
    </section>


    <!-- Multiple Scopes -->
    <section>
      <h2>Scope Variations (Visual Only - No Data Fetching)</h2>

      <div class="demo-grid">
        <div class="demo-item">
          <h3>Admin Scope</h3>
          <changebot-badge count="10" scope="admin" theme="dark"></changebot-badge>
          <p><code>scope="admin"</code></p>
        </div>

        <div class="demo-item">
          <h3>User Scope</h3>
          <changebot-badge count="8" scope="user"></changebot-badge>
          <p><code>scope="user"</code></p>
        </div>

        <div class="demo-item">
          <h3>Default Scope</h3>
          <changebot-badge count="5"></changebot-badge>
          <p><code>scope="default"</code> (implicit)</p>
        </div>
      </div>
    </section>

    <!-- Drawer Component Testing -->
    <section>
      <h2>Drawer/Modal Component</h2>
      <p>Test the updates display component in different modes:</p>

      <div class="demo-grid">
        <div class="demo-item">
          <h3>Drawer Right (Default)</h3>
          <changebot-drawer id="drawer-right"></changebot-drawer>
          <button onclick="openDrawer('drawer-right')">Open Drawer</button>
          <code>&lt;changebot-drawer display-mode="drawer-right"&gt;&lt;/changebot-drawer&gt;</code>
        </div>

        <div class="demo-item">
          <h3>Drawer Left</h3>
          <changebot-drawer id="drawer-left" display-mode="drawer-left"></changebot-drawer>
          <button onclick="openDrawer('drawer-left')">Open Drawer</button>
          <code>&lt;changebot-drawer display-mode="drawer-left"&gt;&lt;/changebot-drawer&gt;</code>
        </div>

        <div class="demo-item">
          <h3>Modal</h3>
          <changebot-drawer id="modal" display-mode="modal"></changebot-drawer>
          <button onclick="openDrawer('modal')">Open Modal</button>
          <code>&lt;changebot-drawer display-mode="modal"&gt;&lt;/changebot-drawer&gt;</code>
        </div>
      </div>

      <div class="controls">
        <h3>Drawer Controls</h3>
        <button onclick="populateDrawers()">Populate with Mock Updates</button>
        <button onclick="clearDrawers()">Clear Updates</button>
        <button onclick="closeAllDrawers()">Close All</button>
      </div>
    </section>

    <!-- Testing Controls -->
    <section>
      <h2>Testing Controls</h2>

      <div class="controls">
        <h3>Manual Badge Control</h3>
        <button onclick="updateAllBadges(0)">Set All to 0</button>
        <button onclick="updateAllBadges(5)">Set All to 5</button>
        <button onclick="updateAllBadges(9)">Set All to 9</button>
        <button onclick="updateAllBadges(10)">Set All to 10 (9+)</button>
        <button onclick="updateAllBadges(99)">Set All to 99 (9+)</button>

        <h3>Local Storage Management</h3>
        <button onclick="clearLastViewed()">Clear Last Viewed (All Scopes)</button>
        <button onclick="clearDefaultScope()">Clear Default Scope Only</button>

        <h3>Event Testing</h3>
        <button onclick="testAction()">Dispatch Test Action</button>
        <button onclick="simulateProviderResponse()">Simulate Provider Response</button>
      </div>

      <div id="status" class="status">
        Ready for testing. Check console for events.
      </div>
    </section>

    <!-- Props Reference -->
    <section>
      <h2>Component Props Reference</h2>

      <h3>changebot-provider</h3>
      <table>
        <tr>
          <th>Prop</th>
          <th>Type</th>
          <th>Default</th>
          <th>Description</th>
        </tr>
        <tr>
          <td><code>slug</code></td>
          <td>string</td>
          <td>-</td>
          <td>Your Changebot product slug (takes precedence over url)</td>
        </tr>
        <tr>
          <td><code>url</code></td>
          <td>string</td>
          <td>-</td>
          <td>Custom API URL (used if slug is not provided)</td>
        </tr>
        <tr>
          <td><code>scope</code></td>
          <td>string</td>
          <td>"default"</td>
          <td>Scope for multiple providers on same page</td>
        </tr>
        <tr>
          <td><code>poll-interval</code></td>
          <td>number</td>
          <td>-</td>
          <td>Polling interval in seconds (minimum 1)</td>
        </tr>
      </table>

      <h3>changebot-badge</h3>
      <table>
        <tr>
          <th>Prop</th>
          <th>Type</th>
          <th>Default</th>
          <th>Description</th>
        </tr>
        <tr>
          <td><code>scope</code></td>
          <td>string</td>
          <td>"default"</td>
          <td>Connect to provider with matching scope</td>
        </tr>
        <tr>
          <td><code>theme</code></td>
          <td>"light" | "dark"</td>
          <td>-</td>
          <td>Badge color theme</td>
        </tr>
        <tr>
          <td><code>show-count</code></td>
          <td>boolean</td>
          <td>true</td>
          <td>Show number or just dot</td>
        </tr>
        <tr>
          <td><code>count</code></td>
          <td>number</td>
          <td>-</td>
          <td>Manual count (bypasses provider)</td>
        </tr>
      </table>

      <h3>changebot-drawer</h3>
      <table>
        <tr>
          <th>Prop</th>
          <th>Type</th>
          <th>Default</th>
          <th>Description</th>
        </tr>
        <tr>
          <td><code>scope</code></td>
          <td>string</td>
          <td>"default"</td>
          <td>Connect to provider with matching scope</td>
        </tr>
        <tr>
          <td><code>theme</code></td>
          <td>"light" | "dark"</td>
          <td>-</td>
          <td>Drawer color theme</td>
        </tr>
        <tr>
          <td><code>display-mode</code></td>
          <td>"drawer-left" | "drawer-right" | "modal"</td>
          <td>"drawer-right"</td>
          <td>Display mode for the updates</td>
        </tr>
      </table>

    </section>

    <!-- Integration Examples -->
    <section>
      <h2>Integration Examples</h2>

      <h3>Basic Setup</h3>
      <pre><code>&lt;!-- Add provider once per page --&gt;
&lt;changebot-provider slug="your-product"&gt;&lt;/changebot-provider&gt;

&lt;!-- Add badge anywhere --&gt;
&lt;changebot-badge&gt;&lt;/changebot-badge&gt;</code></pre>

      <h3>With Polling</h3>
      <pre><code>&lt;changebot-provider
  slug="your-product"
  poll-interval="60"&gt;  &lt;!-- Poll every 60 seconds --&gt;
&lt;/changebot-provider&gt;</code></pre>

      <h3>With Custom URL</h3>
      <pre><code>&lt;!-- Using custom API URL (when slug is not provided) --&gt;
&lt;changebot-provider
  url="https://your-api.com/updates"
  poll-interval="30"&gt;  &lt;!-- Poll every 30 seconds --&gt;
&lt;/changebot-provider&gt;</code></pre>


      <h3>Multiple Scopes</h3>
      <pre><code>&lt;!-- Admin updates --&gt;
&lt;changebot-provider slug="admin-updates" scope="admin"&gt;&lt;/changebot-provider&gt;
&lt;changebot-badge scope="admin"&gt;&lt;/changebot-badge&gt;

&lt;!-- User updates --&gt;
&lt;changebot-provider slug="user-updates" scope="user"&gt;&lt;/changebot-provider&gt;
&lt;changebot-badge scope="user"&gt;&lt;/changebot-badge&gt;</code></pre>
    </section>
  </div>

  <script>
    // Event listeners
    document.addEventListener('changebot:context-request', (e) => {
      console.log('ðŸ”„ Context Request:', e.detail);
    });

    document.addEventListener('changebot:action', (e) => {
      console.log('âš¡ Action Dispatched:', e.detail);
      updateStatus(`Action: ${e.detail.type}`);
    });


    // Testing functions
    function clearLastViewed() {
      localStorage.removeItem('changebot:lastViewed:default');
      localStorage.removeItem('changebot:lastViewed:admin');
      localStorage.removeItem('changebot:lastViewed:user');
      updateStatus('Cleared last viewed timestamps. Reloading...');
      setTimeout(() => location.reload(), 1000);
    }

    function clearDefaultScope() {
      localStorage.removeItem('changebot:lastViewed:default');
      updateStatus('Cleared default scope. Reloading...');
      setTimeout(() => location.reload(), 1000);
    }

    function testAction() {
      const event = new CustomEvent('changebot:action', {
        detail: { type: 'testAction', payload: { test: true } },
        bubbles: true,
        composed: true
      });
      document.dispatchEvent(event);
    }

    // Update all badges with manual count
    function updateAllBadges(count) {
      const badges = document.querySelectorAll('changebot-badge');
      badges.forEach(badge => {
        badge.setAttribute('count', count.toString());
      });
      updateStatus(`Set all badges to ${count}`);
    }

    // Simulate a provider response event
    function simulateProviderResponse() {
      // This would simulate what a provider does when providing context
      const mockServices = {
        store: {
          state: {
            updates: [
              { id: '1', title: 'Mock Update 1', timestamp: Date.now() },
              { id: '2', title: 'Mock Update 2', timestamp: Date.now() - 3600000 }
            ],
            newUpdatesCount: 2,
            isLoading: false
          }
        },
        actions: {
          loadUpdates: () => console.log('Mock loadUpdates called')
        }
      };

      console.log('ðŸŽ­ Simulated Provider Response:', mockServices);
      updateStatus('Simulated provider response - check console');
    }

    function updateStatus(message) {
      const status = document.getElementById('status');
      status.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
      status.style.background = '#d4edda';
      setTimeout(() => {
        status.style.background = '#f8f9fa';
      }, 2000);
    }

    // Drawer control functions
    async function openDrawer(id) {
      const drawer = document.getElementById(id);
      if (drawer) {
        await drawer.open();
        updateStatus(`Opened drawer: ${id}`);
      }
    }

    async function closeAllDrawers() {
      const promises = ['drawer-right', 'drawer-left', 'modal'].map(async id => {
        const drawer = document.getElementById(id);
        if (drawer) {
          await drawer.close();
        }
      });
      await Promise.all(promises);
      updateStatus('Closed all drawers');
    }

    async function populateDrawers() {
      const mockUpdates = [
        {
          id: '1',
          title: 'New Feature: Dark Mode Support',
          description: 'We\'ve added full dark mode support across all components with automatic theme detection.',
          date: '2024-01-15',
          timestamp: Date.now() - 86400000, // 1 day ago
          tags: [
            { text: 'Feature', color: '#3b82f6' },
            { text: 'UI', color: '#8b5cf6' }
          ]
        },
        {
          id: '2',
          title: 'Performance Improvements',
          description: 'Significant performance improvements in rendering and state management.',
          date: '2024-01-10',
          timestamp: Date.now() - 86400000 * 5, // 5 days ago
          tags: [
            { text: 'Performance', color: '#10b981' }
          ]
        },
        {
          id: '3',
          title: 'Bug Fix: ESC Key Handling',
          description: 'Fixed an issue where ESC key wasn\'t properly closing the drawer in certain scenarios.',
          date: '2024-01-08',
          timestamp: Date.now() - 86400000 * 7, // 7 days ago
          tags: [
            { text: 'Bug Fix', color: '#ef4444' }
          ]
        },
        {
          id: '4',
          title: 'New Component: Drawer',
          description: 'Added a new drawer component with left, right, and modal display modes.',
          date: '2024-01-05',
          timestamp: Date.now() - 86400000 * 10, // 10 days ago
          tags: [
            { text: 'Feature', color: '#3b82f6' },
            { text: 'Component', color: '#f59e0b' }
          ]
        }
      ];

      const promises = ['drawer-right', 'drawer-left', 'modal'].map(async id => {
        const drawer = document.getElementById(id);
        if (drawer) {
          await drawer.setUpdates(mockUpdates);
        }
      });
      await Promise.all(promises);

      updateStatus('Populated all drawers with mock updates');
    }

    async function clearDrawers() {
      const promises = ['drawer-right', 'drawer-left', 'modal'].map(async id => {
        const drawer = document.getElementById(id);
        if (drawer) {
          await drawer.setUpdates([]);
        }
      });
      await Promise.all(promises);
      updateStatus('Cleared all drawer updates');
    }

    // Log when ready
    window.addEventListener('load', () => {
      console.log('âœ… Changebot testing page loaded');
      console.log('ðŸŽ¯ Manual testing mode - no API calls');
      console.log('ðŸ”§ Use buttons to control badge counts');
      updateStatus('Manual testing mode - no API calls');
    });
  </script>
</body>
</html>